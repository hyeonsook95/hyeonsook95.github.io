---
layout: post
title:  "동적 메모리 할당"
date:   2020-04-21
excerpt: "동적 메모리 할당이란?"
categories: 
 - CS
tag:
 - c
 - heap
---

__이 글은 개인적으로 여러 글들을 조사하여 편집하고 정리한 내용이므로 오류가 있을 수 있습니다.__

## 메모리
* 데이터와 명령어를 저장하는 공간.

## 프로그래밍시의 메모리 구조

### 프로그램 실행시(런타임) 크기가 결정되는 메모리
* Stack 영역: 지역변수, 사용자 정의함수, 잠깐 사용하고 삭제할 데이터를 저장하는 공간.
* Heap 영역: 동적할당, 사용자의 의사에 의해 원하는 데이터를 사용자정의에 의해 할당된 메모리에 저장하거나 해제하는 공간.
    * 할당시: `malloc`, `new`
    * 해제시: `free`, `delete`

### 컴파일시 컴파일러에 의해 크기가 결정되는 메모리
* Data 영역: 전역변수, 지역변수, static으로 선언되는 변수, 프로그래밍이 종료될 때까지 지워지지 않을 데이터를 저장하는 공간.
* Code 영역: Text, 코드를 저장하는 공간. Editor에서 작성한 명령어들이 여기에 저장됨.

## 정적 메모리 할당
* 프로그램을 실행하기 전에 미리 메모리의 필요량을 할당하는 할당 방법.
* 프로세스의 스택 영역에 할당함.
* 장점: __메모리 누수__ 와 같은 문제를 신경쓰지 않아도 됨. 실행 도중에 해제되지 않고, 프로그램이 종료할 때 운영 체제가 회수함.
* 단점: 메모리 크기가 하드 코딩되어 있어서 조절할 수 없음. 스택에 할당된 메모리이므로 동적 할당에 비해 할당 받을 수 있는 최대 메모리에 제약을 받음.

## 동적 메모리 할당
* 프로그램의 실행 시간(Run Time) 동안, 필요한만큼 메모리 공간을 할당하는 할당 방법.
* 동적으로 할당된 메모리 공간은 프로그래머가 명시적으로 해제하거나 쓰레기 수집이 일어나기 전까지 유지됨.
* C/C++의 경우 쓰레기 수집이 없는 언어이기 때문에, 사용자가 해제하기 전까지는 메모리 공간이 계속 유지됨.
* 프로세스의 힙 영역에 할당하므로 프로세스가 종료되면 운영 체제에 메모리 리소스가 반납되므로 해제됨. 종료하지 않을 경우, 해제되지 않음.
* 정해진 힙 영역을 넘는 메모리 할당을 요구하면 할당되지 않음. 따라서 사용이 완료되면 반납하는 것이 좋음.
* 장점: 필요시에 필요한만큼 할당하여 사용하므로 경제적이며, 이미 할당된 메모리도 언제든 크기를 조절할 수 있음.
* 단점: 사용이 완료되면 명시적으로 메모리를 해제해 주어야 함.

### 동적 메모리 할당 방법
|함수|기능|
|:--:|:--:|
|void* malloc(size_t size)|size 바이트의 메모리를 힙에서 __할당__ 하여 반환.|
|void* calloc(size_t size)|(num* size) 바이트의 메모리를 힙에서 __할당__ 하고 포인터값을 반환.|
|void* realloc(void* ptr, size_t size)|ptr이 가리키는 메모리를 size 바이트만큼 힙에서 __재할당__ 하여 반환.|
|void free(void* ptr)|ptr이 가리키는 메모리를 __해제__.|

## 메모리 관리 원칙
* 메모리의 실체는 시스템에 장착된 RAM임.
* 복수 개의 프로그램을 같이 사용할 경우, 메모리를 충돌없이 잘 사용하려면 정교한 메모리 관리 원칙이 필요함.
* 메모리 관리는 운영체제가 직접함.

1. 메모리 관리의 주체는 운영체제이다.
    * 메모리는 반드시 운영체제를 통해서만 메모리를 할당받을 수 있다.
2. 운영체제는 메모리가 있는 한, 할당 요청을 거절하지 않는다.
3. 한 번 할당된 메모리 공간은 절대로 다른 목적을 위해 할당하지 않는다.
4. 응용 프로그램이 할당된 메모리를 해제하면 운영체제는 이 공간을 빈 영역으로 인식하고 다른 목적을 위해 사용할 수 있도록 한다.

---
* [동적 메모리 할당](https://ko.wikipedia.org/wiki/%EB%8F%99%EC%A0%81_%EB%A9%94%EB%AA%A8%EB%A6%AC_%ED%95%A0%EB%8B%B9)
* [동적할당과 정적할당](https://ghgus0702.tistory.com/11)
* [동적 메모리 할당 개념잡기](https://ghgus0702.tistory.com/11)
